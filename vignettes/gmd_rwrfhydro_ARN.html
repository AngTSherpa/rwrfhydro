<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Arezoo Rafieei Nasab" />

<meta name="date" content="2016-02-04" />

<title>Precipitation Evaluation</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Precipitation Evaluation</h1>
<h4 class="author"><em>Arezoo Rafieei Nasab</em></h4>
<h4 class="date"><em>2016-02-04</em></h4>
</div>


<div id="background" class="section level2">
<h2>Background</h2>
<p>Forcing are stored in multiple files, either in input forcing files (such as LDASIN or PRECIP_FORCING files) or in the output files (LDASOUT). LDASOUT files contains the variable ACCPRCP which stores the accumulated precipitation, and one can calculate the rainfall depth by subtracting two consecutive time steps. LDASIN and PRECIP_FORCING store rain rate in RAINRATE and precip_rate variables. This vignette serve as an short explanation of how to grab data and do some basin comparisons.</p>
<p>Load the rwrfhydro package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rwrfhydro)</code></pre>
</div>
<div id="import-observed-datasets" class="section level2">
<h2>Import observed datasets</h2>
</div>
<div id="ghcn-daily" class="section level2">
<h2>GHCN-daily</h2>
<p>Global Historical Climatology Network-Daily (GHCN-D) dataset contains daily data from around 80000 surface station in the world, which about two third of them are precipitation only (Menne et al. 2012). It is the most complete collection of U.S. daily data available (Menne et al. 2012). The dataset undergo an automated quality assurance which the details can be found in Durre et al. 2008; 2010. Data is available on <a href="http://www1.ncdc.noaa.gov/pub/data/ghcn/daily" class="uri">http://www1.ncdc.noaa.gov/pub/data/ghcn/daily</a> and is updated frequently. Data is available in two formats either categorized by gauge station or categorized by year. Accordingly, there are two function to pull GHCN-daily data from these two sources.</p>
<div id="gauge-selection" class="section level3">
<h3>Gauge selection</h3>
<p>First step is to select the gauges you want to use for verification based on some criteria. GHCN-daily contains the precipitation data from different sources such as COOP or CoCoRaHS. The selection criteria can be country code, states if country is US, type of rain gauge network (for example CoCoRaHS), or a rectangle domain.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setInternet2</span>(<span class="dt">use=</span><span class="ot">FALSE</span>) <span class="co"># If using windows, you may need this.</span>

<span class="co"># Return all the gauges within US from onservation network of COOP (C) and CoCoRahs</span>
countryCodeList &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;US&quot;</span>)
networkCodeList &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;C&quot;</span>)
sg &lt;-<span class="st"> </span><span class="kw">SelectGhcnGauges</span>(<span class="dt">countryCode=</span>countryCodeList,
                       <span class="dt">networkCode=</span>networkCodeList)
<span class="kw">str</span>(sg)</code></pre>
<pre><code>## 'data.frame':    49565 obs. of  12 variables:
##  $ country    : chr  &quot;US&quot; &quot;US&quot; &quot;US&quot; &quot;US&quot; ...
##  $ network    : chr  &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ stationID  : chr  &quot;0RMHS145&quot; &quot;0adam001&quot; &quot;0adam002&quot; &quot;0adam003&quot; ...
##  $ latitude   : num  40.5 40.6 40.5 40.5 40.5 ...
##  $ longitude  : num  -105.1 -98.5 -98.5 -98.7 -98.4 ...
##  $ elevation  : num  1569 598 601 615 570 ...
##  $ state      : chr  &quot;CO&quot; &quot;NE&quot; &quot;NE&quot; &quot;NE&quot; ...
##  $ name       : chr  &quot;RMHS 1.6 SSW                  &quot; &quot;JUNIATA 1.5 S                 &quot; &quot;JUNIATA 6.0 SSW               &quot; &quot;HOLSTEIN 0.1 NW               &quot; ...
##  $ GSNflag    : chr  &quot;   &quot; &quot;   &quot; &quot;   &quot; &quot;   &quot; ...
##  $ HCN/CRNflag: chr  &quot;   &quot; &quot;   &quot; &quot;   &quot; &quot;   &quot; ...
##  $ WMOID      : chr  &quot;    &quot; &quot;    &quot; &quot;    &quot; &quot;    &quot; ...
##  $ siteIds    : chr  &quot;US10RMHS145&quot; &quot;US10adam001&quot; &quot;US10adam002&quot; &quot;US10adam003&quot; ...</code></pre>
<p>The sg dataframe has all the information provided by NCDC about each gauge. For the rest of this vignette we will use only the domain of Fourmile Creek. We use the rectanle domain containing Fourmile, as the boundary to collect all the gauges information.</p>
<pre class="sourceCode r"><code class="sourceCode r">sg &lt;-<span class="st"> </span><span class="kw">SelectGhcnGauges</span>(<span class="dt">domain =</span> <span class="ot">TRUE</span>, <span class="dt">minLat =</span> <span class="fl">40.0125</span>, <span class="dt">maxLat =</span> <span class="fl">40.0682</span>, 
                       <span class="dt">minLon =</span> -<span class="fl">105.562</span>, <span class="dt">maxLon=</span>-<span class="fl">105.323</span>)
<span class="kw">str</span>(sg)</code></pre>
<pre><code>## 'data.frame':    11 obs. of  12 variables:
##  $ country    : chr  &quot;US&quot; &quot;US&quot; &quot;US&quot; &quot;US&quot; ...
##  $ network    : chr  &quot;1&quot; &quot;1&quot; &quot;1&quot; &quot;1&quot; ...
##  $ stationID  : chr  &quot;COBO0063&quot; &quot;COBO0159&quot; &quot;COBO0280&quot; &quot;COBO0297&quot; ...
##  $ latitude   : num  40 40 40 40 40.1 ...
##  $ longitude  : num  -106 -105 -105 -105 -105 ...
##  $ elevation  : num  3026 2105 2319 2335 2032 ...
##  $ state      : chr  &quot;CO&quot; &quot;CO&quot; &quot;CO&quot; &quot;CO&quot; ...
##  $ name       : chr  &quot;NEDERLAND 5.2 NNW             &quot; &quot;BOULDER 3.6 WNW               &quot; &quot;BOULDER 7.0 W                 &quot; &quot;BOULDER 7.4 W                 &quot; ...
##  $ GSNflag    : chr  &quot;   &quot; &quot;   &quot; &quot;   &quot; &quot;   &quot; ...
##  $ HCN/CRNflag: chr  &quot;   &quot; &quot;   &quot; &quot;   &quot; &quot;   &quot; ...
##  $ WMOID      : chr  &quot;    &quot; &quot;    &quot; &quot;    &quot; &quot;    &quot; ...
##  $ siteIds    : chr  &quot;US1COBO0063&quot; &quot;US1COBO0159&quot; &quot;US1COBO0280&quot; &quot;US1COBO0297&quot; ...</code></pre>
</div>
<div id="getghcn" class="section level3">
<h3>GetGhcn</h3>
<p>GetGhcn GHCN-daily data are archived for each individual gauge in a text file in <a href="http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/all/" class="uri">http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/all/</a>. Precipitating can be downloaded for a single site or multiple ones by setting element to “PRCP” and specifying the desired start and end date.</p>
<pre class="sourceCode r"><code class="sourceCode r">startDate &lt;-<span class="st"> &quot;2015/06/01&quot;</span>
endDate &lt;-<span class="st"> &quot;2015/09/01&quot;</span>
element &lt;-<span class="st"> &quot;PRCP&quot;</span>
obsPrcp &lt;-<span class="st"> </span><span class="kw">GetGhcn</span>(sg$siteIds, element, startDate, endDate, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)</code></pre>
</div>
<div id="getghcn2" class="section level3">
<h3>GetGhcn2</h3>
<p>NCDC also provides GHCN-daily categorized by year under <a href="http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/by_year/" class="uri">http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/by_year/</a>. If the number of the gauges are high, GetGhcn2 is much faster in retrieving data.</p>
<pre class="sourceCode r"><code class="sourceCode r">startDate &lt;-<span class="st"> &quot;2015/05/01&quot;</span>
endDate &lt;-<span class="st"> &quot;2015/10/01&quot;</span>
element &lt;-<span class="st"> &quot;PRCP&quot;</span>
obsPrcp &lt;-<span class="st"> </span><span class="kw">GetGhcn2</span>(sg$siteIds, element, startDate, endDate, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)
<span class="kw">head</span>(obsPrcp)</code></pre>
<pre><code>##       siteIds       date element value mFlag qFlag sFlag reportTime
## 1 USS0005J42S 2015-05-01    PRCP   0.0                 T           
## 2 USW00094075 2015-05-01    PRCP   0.5                 R           
## 3 USS0005J42S 2015-05-02    PRCP   0.0                 T           
## 4 USW00094075 2015-05-02    PRCP   0.0                 R           
## 5 USS0005J42S 2015-05-03    PRCP   5.1                 T           
## 6 USW00094075 2015-05-03    PRCP   4.8                 R</code></pre>
</div>
<div id="import-forcingprecipitation-data-used-in-wrf-hydro-model" class="section level3">
<h3>Import forcing/precipitation data used in WRF-Hydro model</h3>
<p>Forcing data used in WRF-Hydro modeling are usually stored in forcing files (such as LDASIN or PRECIP_FORCING files). Here we are going to use the data provided under “Fourmile_Creek” dataset.</p>
<p>Set a data path to the Fourmile Creek test case.</p>
<pre class="sourceCode r"><code class="sourceCode r">fcPath &lt;-<span class="st"> '~/wrfHydroTestCases/Fourmile_Creek_newGMD'</span></code></pre>
<p>Firs make a list of all the forcing files.</p>
<pre class="sourceCode r"><code class="sourceCode r">forcingPath &lt;-<span class="st"> </span><span class="kw">paste0</span>(fcPath,<span class="st">&quot;/FORCING&quot;</span>)
files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path =</span> forcingPath, <span class="dt">full.names =</span> <span class="ot">TRUE</span>, <span class="dt">pattern =</span> <span class="st">&quot;LDASIN_DOMAIN&quot;</span>)</code></pre>
<p>In order to be able to pull data from the netcdf files, one need the location of any point in the geogrid domain file, while only lat/lon locations of rain gauges are available in case of using SelectGhcnGauges function. Therefore, it is required to map lat/lon information to x/y information in geogrid in order to pull the data from the netcdf files. This can be done by calling GetGeogridIndex function in rwrfhydro. One need to provide the address to geogrid file, the lat/lon info and the function return a dataframe with two column sn (south-north) and ew (east-west).</p>
<pre class="sourceCode r"><code class="sourceCode r">geoFile &lt;-<span class="st"> </span><span class="kw">paste0</span>(fcPath,<span class="st">'/DOMAIN/geo_OrodellBasin_1km_8nlcd11.nc'</span>)
rainGgaugeInds &lt;-<span class="st"> </span><span class="kw">GetGeogridIndex</span>(<span class="dt">xy =</span> <span class="kw">data.frame</span>(<span class="dt">lon=</span>sg$longitude, <span class="dt">lat=</span>sg$latitude),
                                  <span class="dt">ncfile =</span> geoFile)
sg &lt;-<span class="st"> </span><span class="kw">cbind</span>(sg,rainGgaugeInds)
<span class="kw">head</span>(sg)</code></pre>
<pre><code>##       country network stationID latitude longitude elevation state
## 49717      US       1  COBO0063  40.0359 -105.5442    3026.1    CO
## 49771      US       1  COBO0159  40.0395 -105.3275    2104.9    CO
## 49825      US       1  COBO0280  40.0295 -105.3842    2319.2    CO
## 49835      US       1  COBO0297  40.0305 -105.3918    2335.4    CO
## 49839      US       1  COBO0301  40.0507 -105.3741    2031.8    CO
## 49843      US       1  COBO0318  40.0394 -105.3612    1931.8    CO
##                                 name GSNflag HCN/CRNflag WMOID     siteIds
## 49717 NEDERLAND 5.2 NNW                                        US1COBO0063
## 49771 BOULDER 3.6 WNW                                          US1COBO0159
## 49825 BOULDER 7.0 W                                            US1COBO0280
## 49835 BOULDER 7.4 W                                            US1COBO0297
## 49839 BOULDER 6.7 WNW                                          US1COBO0301
## 49843 BOULDER 5.9 W                                            US1COBO0318
##       ew sn
## 49717  2  4
## 49771 21  4
## 49825 16  3
## 49835 15  3
## 49839 17  5
## 49843 18  4</code></pre>
<p>Now we can pull data. One needs to prepare the file, var, and ind variables for GetMultiNcdf function (refer to Collect Output Data: GetMultiNcdf vignette . You can leave the stat as mean; since you are pulling data for single pixels, means return the value of the pixel.</p>
<pre class="sourceCode r"><code class="sourceCode r">flList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">forcing =</span> files)
varList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">forcing =</span> <span class="kw">list</span>(<span class="dt">PRCP =</span> <span class="st">'RAINRATE'</span>))
prcpIndex &lt;-<span class="st"> </span><span class="kw">list</span>()
for (i in <span class="dv">1</span>:<span class="kw">length</span>(sg$siteIds)) {
    if (!<span class="kw">is.na</span>(sg$ew[i]) &amp;<span class="st"> </span>!<span class="kw">is.na</span>(sg$sn[i])) {
      prcpIndex[[<span class="kw">as.character</span>(sg$siteIds[i])]] &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">start=</span><span class="kw">c</span>(sg$ew[i], sg$sn[i],<span class="dv">1</span>),
                                                       <span class="dt">end=</span><span class="kw">c</span>(sg$ew[i], sg$sn[i],<span class="dv">1</span>), <span class="dt">stat=</span><span class="st">&quot;mean&quot;</span>)
   }
}
indList &lt;-<span class="kw">list</span>(<span class="dt">forcing =</span> <span class="kw">list</span>(<span class="dt">PRCP =</span> prcpIndex))
prcpData &lt;-<span class="st"> </span><span class="kw">GetMultiNcdf</span>(<span class="dt">file =</span> flList, <span class="dt">var =</span> varList, <span class="dt">ind =</span> indList, <span class="dt">parallel=</span><span class="ot">FALSE</span>)
<span class="kw">head</span>(prcpData)</code></pre>
<pre><code>##               POSIXct          inds stat     statArg variable value
## 1 2013-11-05 21:00:00   2:2,4:4,1:1 mean US1COBO0063 RAINRATE     0
## 2 2013-11-05 21:00:00 21:21,4:4,1:1 mean US1COBO0159 RAINRATE     0
## 3 2013-11-05 21:00:00 16:16,3:3,1:1 mean US1COBO0280 RAINRATE     0
## 4 2013-11-05 21:00:00 15:15,3:3,1:1 mean US1COBO0297 RAINRATE     0
## 5 2013-11-05 21:00:00 17:17,5:5,1:1 mean US1COBO0301 RAINRATE     0
## 6 2013-11-05 21:00:00 18:18,4:4,1:1 mean US1COBO0318 RAINRATE     0
##   variableGroup fileGroup
## 1          PRCP   forcing
## 2          PRCP   forcing
## 3          PRCP   forcing
## 4          PRCP   forcing
## 5          PRCP   forcing
## 6          PRCP   forcing</code></pre>
<p>GetMultiNcdf pulls the time information from the netcdf files, if the data is not prepared properly, and the time info is not available it will return the name of the file instead. In that case time should be retrieved from the file name which is save as column POSIXct. Since the GHCN data are converted to mm, we convert the rainrate to rain depth in an hour.</p>
<pre class="sourceCode r"><code class="sourceCode r">prcpData$value&lt;-prcpData$value*<span class="dv">3600</span></code></pre>
</div>
<div id="aggregating-hourly-data-into-daily." class="section level3">
<h3>aggregating hourly data into daily.</h3>
<p>Each GHCN gauge has a unique reporting time which the daily data is been calculated based on that. The reporting time is archived in the csv files and is retrieved when calling GetGhcn2 function (you will not get the reporting time using GetGhcn. When there is not reporting time, “0700” is used instead. We need to add the reporting time for each point which would be the base for daily aggregation.If there will not be any reportTime in sg columns, then it uses the default which is 700 AM.</p>
<pre class="sourceCode r"><code class="sourceCode r">sg$reportTime &lt;-<span class="st"> </span>obsPrcp$reportTime[<span class="kw">match</span>(sg$siteIds, obsPrcp$siteIds)]
sg$reportTime[<span class="kw">which</span> (sg$reportTime==<span class="st">&quot;&quot;</span>)]&lt;-<span class="dv">700</span></code></pre>
<p>Call the CalcDailyGhcn function which takes the following steps: 1- It first search for a column called “timeZone” in the sg (selected gauges) dataframe. If the time zone is has not been provided, it will call GetTimeZone(sg). To GetTimeZone works, sg requires to have at least two fields of latitude and longitude. 2- Having time zone for each gauge, the time offset will be obtained from the tzLookup data provided under rwrfhydro.Using the time offset, the UTC time of the precipitation will be converted to Local Standard Time (LST). This is the time convention, GHCN-D data report. 3- The precipitation data will be aggreagted based on the reporting time of individual gauge.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(prcpData)[<span class="kw">names</span>(prcpData) ==<span class="st"> 'value'</span>] &lt;-<span class="st"> 'DEL_ACCPRCP'</span>
dailyData&lt;-<span class="kw">CalcDailyGhcn</span>(<span class="dt">sg =</span> sg,<span class="dt">prcp =</span> prcpData)
<span class="kw">head</span>(dailyData)</code></pre>
<pre><code>##      ghcnDay     statArg dailyPrcp
## 1 2013-11-06 US1COBO0063         0
## 2 2013-11-06 US1COBO0159         0
## 3 2013-11-06 US1COBO0280         0
## 4 2013-11-06 US1COBO0297         0
## 5 2013-11-06 US1COBO0301         0
## 6 2013-11-06 US1COBO0318         0</code></pre>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
